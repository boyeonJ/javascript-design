## ìƒíƒœíŒ¨í„´(í–‰ìœ„ íŒ¨í„´)

í–‰ìœ„ íŒ¨í„´(Behavioral Pattern) ì¤‘ í•˜ë‚˜ë¡œ, ê°ì²´ê°€ ë‚´ë¶€ ìƒíƒœ(state) ë³€ê²½ì— ë”°ë¼ **í–‰ë™(behavior)ê³¼ ìƒíƒœ ì „ì´**ë¥¼ `ê°ê°ì˜ ìƒíƒœ ê°ì²´`ì— ìœ„ì„í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.

### ë“±ì¥ë°°ê²½

ë½‘ê¸° ê¸°ê³„ë¥¼ ê°œë°œí• ë•Œ, â€œë™ì „ ìˆìŒâ€, â€œë™ì „ ì—†ìŒâ€, â€œìƒí’ˆ íŒë§¤â€, â€œìƒí’ˆ ë§¤ì§„â€ ë“±ì˜ ìƒíƒœëŠ” â€œë™ì „ íˆ¬ì…â€, â€œë™ì „ ë°˜í™˜â€, â€œì†ì¡ì´ ëŒë¦¼â€, â€œì•Œë§¹ì´ ë‚´ë³´ëƒ„â€ ë“±ì˜ í–‰ë™ì— ë”°ë¼ ë³€ê²½ë©ë‹ˆë‹¤. 

ê°ê°ì˜ í–‰ë™ì— ëŒ€í•œ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ë´…ì‹œë‹¤. ì•„ë˜ì™€ ê°™ì€ ê³ ë ¤ì‚¬í•­ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. í˜„ì¬ ìƒíƒœì— ë”°ë¼ í–‰ë™ì„ ë‹¤ë¥´ê²Œ êµ¬í˜„í•œë‹¤.
2. í–‰ë™ì„ ëª¨ë‘ ë§ˆì¹œ í›„ì˜ ìƒíƒœì— ë”°ë¼ ë‹¤ìŒ ìƒíƒœë¥¼ ì •í•œë‹¤.

ìœ„ì™€ ê°™ì€ ìƒí™©ì„ ê³ ë ¤í•˜ì—¬ êµ¬í˜„í•˜ë ¤ë©´ í–‰ë™ í•¨ìˆ˜ ë‚´ë¶€ì˜ ë§ì€ if-elseê°€ í•„ìš”í•©ë‹ˆë‹¤. ë˜í•œ, ë³€ê²½ ì‚¬í•­ì´ ë°œìƒ(ì¬ê³  ë³´ì¶©, íŠ¹ë³„ ë³´ë„ˆìŠ¤ ìƒí’ˆ ì§€ê¸‰ ë“±ë“±)í•˜ë©´ ë‚´ë¶€ ì½”ë“œë¥¼ ì „ì²´ì ìœ¼ë¡œ ê³ ë ¤í•˜ì—¬ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤. (ë²„ê·¸ ë°œìƒ ìœ„í—˜ ë†’ì•„ì§)

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ ì ê°ê°ì˜ ìƒíƒœì— ëŒ€í•œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ (`NoCoinState`, `HasCoinState`, `SoldState`, `SoldOutState`) ë‚´ë¶€ì—ì„œëŠ” í˜„ì¬ ìƒíƒœì—ì„œ ì‹¤í–‰í•  í–‰ë™(`insertCoin()`, `ejectCoin() ...`)ê³¼ ìƒíƒœì „ì´ë¥¼ ì²˜ë¦¬í•˜ë„ë¡ ìº¡ìŠí™” í•˜ì—¬ ê°ê°ì˜ ê°ì²´ì—ê²Œ ì±…ì„ì„ ìœ„ì„í•˜ëŠ” íŒ¨í„´ì´ ìƒíƒœ íŒ¨í„´ì´ ë“±ì¥í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ê°ê°ì˜ ê°ì²´ì—ê²Œ ìœ„ì„í•˜ê²Œ ë˜ë©´ OCPë¥¼ ì¤€ìˆ˜í•˜ê²Œ ë˜ì–´ í™•ì¥ì´ ìš©ì´í•˜ê³ , SRPë¥¼ ì¤€ìˆ˜í•˜ê²Œ ë˜ì–´ í…ŒìŠ¤íŠ¸ê°€ ìš©ì´í•´ì§‘ë‹ˆë‹¤.  

> ì´ë¡œì¨ **State íŒ¨í„´**ì„ ë„ì…í•˜ë©´ â€œìƒíƒœë³„ í–‰ë™ê³¼ ì „ì´ë¥¼ í•œê³³ì— ì‚°ì¬ì‹œì¼œ ë³µì¡ì„±ì„ í‚¤ìš°ëŠ” ë¬¸ì œâ€ë¥¼ í•´ê²°í•˜ê³ , **ê°€ë…ì„±Â·í™•ì¥ì„±Â·ìœ ì—°ì„±**ì„ ëª¨ë‘ í™•ë³´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> 

![image](https://github.com/user-attachments/assets/03193666-f300-4f19-b689-8c691e4cad02)

### í•µì‹¬ ì•„ì´ë””ì–´

1. `State Context`ì˜ ë¼ˆëŒ€ë¥¼ ë§Œë“­ë‹ˆë‹¤. 
    1. ì•„ë˜ì—ì„œ ë§Œë“¤ `State Object`ë¥¼ ë³´ìœ í•˜ê³  ìƒíƒœ ì „ì˜ë¥¼ ê´€ë¦¬í•˜ëŠ” **ìƒíƒœì˜ ì£¼ì¸**
2. `State Interface`ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    1. ëª¨ë“  í–‰ë™ ë©”ì„œë“œ
3. `State Interface`ë¡œ ê°ê°ì˜ `State Object` ìƒì„±í•©ë‹ˆë‹¤.
    1. ëª¨ë“  í–‰ë™ ë§¤ì„œë“œ êµ¬í˜„
    2. State Contextë¥¼ ì°¸ì¡°
        1. constructor parameterë¡œ ì£¼ì… ë°›ìŒ
        2. ìƒíƒœ ë‚´ë¶€ë¡œ ì˜ì¡´ì„± ì£¼ì…(DI)
        3. State Context ê°ì²´ë¥¼ ì°¸ì¡° = ìƒíƒœ ê°ì²´ê°€ **ìì‹ ì„ ë³´ìœ í•œ** ì»¨í…ìŠ¤íŠ¸ ê°ì²´ë¥¼ **ì¡°ì‘í• ** ìˆ˜ ìˆë„ë¡ ì£¼ì…ëœ Context ë ˆí¼ëŸ°ìŠ¤
        4. ìƒì†, êµ¬ì„± x
4. `State Context`ì˜ ë‚´ë¶€ë¥¼ ë‹¤ì‹œ êµ¬í˜„í•©ë‹ˆë‹¤.
    1. ê°ê°ì˜ ìƒíƒœë¥¼ ìƒì„± ë° ì†Œìœ í•©ë‹ˆë‹¤. (new ì‚¬ìš©, êµ¬ì„± ê´€ê³„)
    2. ìƒíƒœ ì „ì˜ë¥¼ ìœ„í•œ ì„¸í„°/ì¼€í„°ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
    3. ì‹¤ì œ ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•  ë™ì‘ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
5. ì™¸ë¶€ì—ì„œëŠ” ê°ê°ì˜ ìƒíƒœ ê°ì²´ë¥¼ ë°”ë¼ë³¼ í•„ìš” ì—†ì´, State Contextë§Œ ë°”ë¼ë´…ë‹ˆë‹¤.

ê²°ê³¼ì ìœ¼ë¡œ

- Context â†’ State
    - êµ¬ì„± ê´€ê³„ - Composition
    - Contextê°€ Stateê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ì†Œìœ 
    - Contextê°€ ì œê±°ë˜ë©´ Stateë“¤ë„ ê°™ì´ ì†Œë©¸(ìƒëª…ì£¼ê¸°ë¥¼ ì±…ì„ì§)
- State â†’ Context
    - ì—°ê´€/ì°¸ì¡°  ê´€ê³„ - Association/Reference
    - StateëŠ” ì™¸ë¶€ì˜ Contextë¥¼ ì°¸ì¡°
    - StateëŠ” Contextì˜ ìƒëª…ì£¼ê¸°ë¥¼ ì±…ì„ì§€ì§€ x
- ê²°êµ­ ì„œë¡œ ì–‘ë°©í–¥ìœ¼ë¡œ ì—°ê´€ì´ ë˜ì–´ìˆì§€ë§Œ ì„œë¡œ ë‹¤ë¥¸ ì„±ê²©ì˜ ê´€ê³„ë¥¼ ê°€ì§‘ë‹ˆë‹¤.


```
ğŸ’¡ êµ¬ì„± ê´€ê³„ vs ì°¸ì¡° ê´€ê³„

(1) êµ¬ì„± ê´€ê³„
êµ¬ì„± ê´€ê³„ëŠ” ì†ŒìŠ¤ ì½”ë“œ ë‚´ì—ì„œ newë¥¼ ì¨ì„œ ë‚´ë¶€ì—ì„œ ì§ì ‘ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ê·¸ ê°ì²´ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ìì‹ ì´ ì±…ì„ì§‘ë‹ˆë‹¤.
â‡’ ë¶€ë¶„(part)ì´ ì „ì²´(whole)ì— ê°•í•˜ê²Œ ì¢…ì†ë˜ì–´, ì „ì²´ê°€ ìƒì„±Â·íŒŒê´´ë  ë•Œ ë¶€ë¶„ë„ í•¨ê»˜ ìƒì„±Â·íŒŒê´´ë˜ì–´ì•¼ í•  ë•Œ ì‚¬ìš©

(2) ì°¸ì¡° ê´€ê³„
ì°¸ì¡°ê´€ê³„ëŠ” ì™¸ë¶€ì—ì„œ ë§Œë“¤ì–´ì§„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë‹¨ìˆœíˆ constructor íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì™€ì„œ ì°¸ì¡°ë§Œ í• ë‹¹í•˜ì—¬ ì‚¬ìš©ë§Œ í• ë¿, ìƒì„±/íŒŒê´´ ì±…ì„ì€ ì—†ìŠµë‹ˆë‹¤.
â‡’ í•œ ê°ì²´ê°€ ë‹¤ë¥¸ ê°ì²´ë¥¼ ì‚¬ìš©ë§Œ í•´ì•¼ í• ë•Œ ì‚¬ìš©
```
### ì‹¤ì œ í™œìš©

State interface

```jsx
export interface State {
  insertCoin(): void;
  ejectCoin(): void;
  turnCrank(): void;
  dispense(): void;
}
```

Context class

```jsx
import { State } from './State';
import { NoCoinState } from './NoCoinState';
import { HasCoinState } from './HasCoinState';
import { SoldState } from './SoldState';
import { SoldOutState } from './SoldOutState';

export class GumballMachine {
  private noCoinState: State;
  private hasCoinState: State;
  private soldState:   State;
  private soldOutState: State;

  private state: State;
  private count: number;

  constructor(count: number) {
    this.count = count;
    this.noCoinState   = new NoCoinState(this);
    this.hasCoinState  = new HasCoinState(this);
    this.soldState     = new SoldState(this);
    this.soldOutState  = new SoldOutState(this);

    this.state = count > 0 ? this.noCoinState : this.soldOutState;
  }

  // ìƒíƒœ ì „ì´ë¥¼ ìœ„í•œ ì„¸í„°/ê²Œí„°
  setState(state: State) {
    this.state = state;
  }
  getNoCoinState()   { return this.noCoinState; }
  getHasCoinState()  { return this.hasCoinState; }
  getSoldState()     { return this.soldState; }
  getSoldOutState()  { return this.soldOutState; }

  // ì•Œë§¹ì´ ì¬ê³  ì°¨ê°
  releaseBall(): void {
    if (this.count > 0) {
      console.log('ì•Œë§¹ì´ ë‚˜ê°€ëŠ” ì¤‘...');
      this.count--;
    }
  }

  // ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•  ë™ì‘
  insertCoin()  { this.state.insertCoin();  }
  ejectCoin()   { this.state.ejectCoin();   }
  turnCrank()   {
    this.state.turnCrank();
    this.state.dispense();
  }

  getCount() { return this.count; }
}
```

ê°ê°ì˜ State Object

```jsx
import { State } from './State';
import { GumballMachine } from './GumballMachine';

export class NoCoinState implements State {
  constructor(private machine: GumballMachine) {}

  insertCoin(): void {
    console.log('ë™ì „ì´ íˆ¬ì…ë˜ì—ˆìŠµë‹ˆë‹¤.');
    this.machine.setState(this.machine.getHasCoinState());
  }
  ejectCoin(): void {
    console.log('ë™ì „ì´ ì—†ìŠµë‹ˆë‹¤. ë°˜í™˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }
  turnCrank(): void {
    console.log('ë¨¼ì € ë™ì „ì„ ë„£ì–´ì£¼ì„¸ìš”.');
  }
  dispense(): void {
    console.log('ì•Œë§¹ì´ë¥¼ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }
}

// HasCoinState.ts
import { State } from './State';
import { GumballMachine } from './GumballMachine';

export class HasCoinState implements State {
  constructor(private machine: GumballMachine) {}

  insertCoin(): void {
    console.log('ì´ë¯¸ ë™ì „ì´ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€ë¡œ ë„£ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }
  ejectCoin(): void {
    console.log('ë™ì „ì„ ë°˜í™˜í•©ë‹ˆë‹¤.');
    this.machine.setState(this.machine.getNoCoinState());
  }
  turnCrank(): void {
    console.log('ì†ì¡ì´ë¥¼ ëŒë¦¬ì…¨ìŠµë‹ˆë‹¤...');
    this.machine.setState(this.machine.getSoldState());
  }
  dispense(): void {
    console.log('ì•Œë§¹ì´ë¥¼ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }
}

// SoldState.ts
import { State } from './State';
import { GumballMachine } from './GumballMachine';

export class SoldState implements State {
  constructor(private machine: GumballMachine) {}

  insertCoin(): void {
    console.log('ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”. ì•Œë§¹ì´ê°€ ë‚˜ê°€ëŠ” ì¤‘ì…ë‹ˆë‹¤.');
  }
  ejectCoin(): void {
    console.log('ì´ë¯¸ ì†ì¡ì´ë¥¼ ëŒë¦¬ì…¨ìŠµë‹ˆë‹¤. ë°˜í™˜ ë¶ˆê°€í•©ë‹ˆë‹¤.');
  }
  turnCrank(): void {
    console.log('ì†ì¡ì´ëŠ” í•œ ë²ˆë§Œ ëŒë ¤ì£¼ì„¸ìš”.');
  }
  dispense(): void {
    this.machine.releaseBall();
    if (this.machine.getCount() > 0) {
      this.machine.setState(this.machine.getNoCoinState());
    } else {
      console.log('ì•Œë§¹ì´ê°€ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤.');
      this.machine.setState(this.machine.getSoldOutState());
    }
  }
}

// SoldOutState.ts
import { State } from './State';
import { GumballMachine } from './GumballMachine';

export class SoldOutState implements State {
  constructor(private machine: GumballMachine) {}

  insertCoin(): void {
    console.log('ë” ì´ìƒ íŒë§¤í•  ì•Œë§¹ì´ê°€ ì—†ìŠµë‹ˆë‹¤. ë™ì „ì„ ë°˜í™˜í•©ë‹ˆë‹¤.');
  }
  ejectCoin(): void {
    console.log('ë™ì „ì´ ì—†ìŠµë‹ˆë‹¤.');
  }
  turnCrank(): void {
    console.log('ì•Œë§¹ì´ê°€ ì—†ì–´ì„œ ì†ì¡ì´ë¥¼ ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }
  dispense(): void {
    console.log('ì•Œë§¹ì´ê°€ ì—†ìŠµë‹ˆë‹¤.');
  }
}
```

ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„

```jsx
// main.ts (í…ŒìŠ¤íŠ¸)
import { GumballMachine } from './GumballMachine';

const machine = new GumballMachine(2);

machine.insertCoin();
machine.turnCrank();
// ë™ì „ì´ íˆ¬ì…ë˜ì—ˆìŠµë‹ˆë‹¤.
// ì†ì¡ì´ë¥¼ ëŒë¦¬ì…¨ìŠµë‹ˆë‹¤...
// ì•Œë§¹ì´ ë‚˜ê°€ëŠ” ì¤‘...
// ìƒíƒœê°€ NoCoinStateë¡œ ì „ì´

machine.insertCoin();
machine.ejectCoin();
// ë™ì „ì´ íˆ¬ì…ë˜ì—ˆìŠµë‹ˆë‹¤.
// ë™ì „ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

machine.insertCoin();
machine.turnCrank();
machine.insertCoin();
machine.turnCrank();
// ì•Œë§¹ì´ ë‚˜ê°€ëŠ” ì¤‘...
// ì•Œë§¹ì´ê°€ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤.
// ë” ì´ìƒ íŒë§¤í•  ì•Œë§¹ì´ê°€ ì—†ìŠµë‹ˆë‹¤. ë™ì „ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
// ì•Œë§¹ì´ê°€ ì—†ìŠµë‹ˆë‹¤.
```
